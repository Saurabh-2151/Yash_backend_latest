package com.company.attendance.controller;

import com.company.attendance.dto.ShiftDto;
import com.company.attendance.entity.Shift;
import com.company.attendance.mapper.ShiftMapper;
import com.company.attendance.service.ShiftService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.stream.Collectors;

@RestController
@RequestMapping("/api/shifts")
@RequiredArgsConstructor
@CrossOrigin(origins = "*")
public class ShiftController {
    private final ShiftService shiftService;
    private final ShiftMapper shiftMapper;

    @GetMapping
    public ResponseEntity<List<ShiftDto>> getAllShifts() {
        List<Shift> shifts = shiftService.findAll();
        List<ShiftDto> dtos = shifts.stream()
                .map(shiftMapper::toDto)
                .collect(Collectors.toList());
        return ResponseEntity.ok(dtos);
    }

    @GetMapping("/{id}")
    public ResponseEntity<ShiftDto> getShiftById(@PathVariable Long id) {
        return shiftService.findById(id)
                .map(shiftMapper::toDto)
                .map(ResponseEntity::ok)
                .orElse(ResponseEntity.notFound().build());
    }

    @PostMapping
    public ResponseEntity<ShiftDto> createShift(@Valid @RequestBody ShiftDto dto) {
        Shift shift = shiftMapper.toEntity(dto);
        Shift saved = shiftService.save(shift);
        return ResponseEntity.ok(shiftMapper.toDto(saved));
    }

    @PutMapping("/{id}")
    public ResponseEntity<ShiftDto> updateShift(@PathVariable Long id, @Valid @RequestBody ShiftDto dto) {
        Shift shift = shiftMapper.toEntity(dto);
        Shift updated = shiftService.update(id, shift);
        return ResponseEntity.ok(shiftMapper.toDto(updated));
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteShift(@PathVariable Long id) {
        shiftService.delete(id);
        return ResponseEntity.noContent().build();
    }

    @GetMapping("/organization/{organizationId}")
    public ResponseEntity<List<ShiftDto>> getShiftsByOrganization(@PathVariable Long organizationId) {
        List<Shift> shifts = shiftService.findByOrganizationId(organizationId);
        List<ShiftDto> dtos = shifts.stream()
                .map(shiftMapper::toDto)
                .collect(Collectors.toList());
        return ResponseEntity.ok(dtos);
    }

    @GetMapping("/active/{isActive}")
    public ResponseEntity<List<ShiftDto>> getShiftsByStatus(@PathVariable Boolean isActive) {
        List<Shift> shifts = shiftService.findByIsActive(isActive);
        List<ShiftDto> dtos = shifts.stream()
                .map(shiftMapper::toDto)
                .collect(Collectors.toList());
        return ResponseEntity.ok(dtos);
    }
}
